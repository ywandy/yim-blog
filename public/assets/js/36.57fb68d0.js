(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{588:function(s,t,n){"use strict";n.r(t);var e=n(13),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"基础知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础知识"}},[s._v("#")]),s._v(" 基础知识")]),s._v(" "),n("p",[s._v("一个 "),n("em",[s._v("Deployment")]),s._v(" 控制器为 "),n("a",{attrs:{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Pods"),n("OutboundLink")],1),s._v(" 和 "),n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/replicaset/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ReplicaSets"),n("OutboundLink")],1),s._v(" 提供声明式的更新能力。")]),s._v(" "),n("p",[s._v("你负责描述 Deployment 中的 "),n("em",[s._v("目标状态")]),s._v("，而 Deployment 控制器以受控速率更改实际状态， 使其变为期望状态。你可以定义 Deployment 以创建新的 ReplicaSet，或删除现有 Deployment， 并通过新的 Deployment 收养其资源。")]),s._v(" "),n("p",[s._v("注意：不要管理 Deployment 所拥有的 ReplicaSet 。")]),s._v(" "),n("p",[s._v("以下是 Deployments 的典型用例：")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#creating-a-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("创建 Deployment 以将 ReplicaSet 上线"),n("OutboundLink")],1),s._v("。 ReplicaSet 在后台创建 Pods。 检查 ReplicaSet 的上线状态，查看其是否成功。")]),s._v(" "),n("li",[s._v("通过更新 Deployment 的 PodTemplateSpec，"),n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#updating-a-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("声明 Pod 的新状态"),n("OutboundLink")],1),s._v(" 。 新的 ReplicaSet 会被创建，Deployment 以受控速率将 Pod 从旧 ReplicaSet 迁移到新 ReplicaSet。 每个新的 ReplicaSet 都会更新 Deployment 的修订版本。")]),s._v(" "),n("li",[s._v("如果 Deployment 的当前状态不稳定，"),n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("回滚到较早的 Deployment 版本"),n("OutboundLink")],1),s._v("。 每次回滚都会更新 Deployment 的修订版本。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("扩大 Deployment 规模以承担更多负载"),n("OutboundLink")],1),s._v("。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#pausing-and-resuming-a-deployment",target:"_blank",rel:"noopener noreferrer"}},[s._v("暂停 Deployment"),n("OutboundLink")],1),s._v(" 以应用对 PodTemplateSpec 所作的多项修改， 然后恢复其执行以启动新的上线版本。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#deployment-status",target:"_blank",rel:"noopener noreferrer"}},[s._v("使用 Deployment 状态"),n("OutboundLink")],1),s._v(" 来判定上线过程是否出现停滞。")]),s._v(" "),n("li",[n("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#clean-up-policy",target:"_blank",rel:"noopener noreferrer"}},[s._v("清理较旧的不再需要的 ReplicaSet"),n("OutboundLink")],1),s._v(" 。")])]),s._v(" "),n("h2",{attrs:{id:"命令行运行一个deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#命令行运行一个deployment"}},[s._v("#")]),s._v(" 命令行运行一个Deployment")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment -h")]),s._v("\nUsage:\n  kubectl create deployment NAME --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("image -- "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COMMAND"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("args"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nExamples:\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a deployment named my-dep that runs the busybox image.")]),s._v("\n  kubectl create deployment my-dep --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a deployment with command")]),s._v("\n  kubectl create deployment my-dep --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox -- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a deployment named my-dep that runs the nginx image with 3 replicas.")]),s._v("\n  kubectl create deployment my-dep --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx --replicas"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a deployment named my-dep that runs the busybox image and expose port 5701.")]),s._v("\n  kubectl create deployment my-dep --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox --port"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5701")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#例:")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 创建")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment testdep --image=nginx:1.8.1 -n mytest")]),s._v("\ndeployment.apps/testdep created\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps -n mytest")]),s._v("\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\ntestdep   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           44s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm k8s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n mytest")]),s._v("\nNAME                       READY   STATUS    RESTARTS   AGE\ntestdep-64c98ff7d7-9ph5j   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          50s\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 扩展")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps  -n mytest")]),s._v("\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\ntestdep   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           4m6s\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n mytest")]),s._v("\nNAME                       READY   STATUS    RESTARTS   AGE\ntestdep-64c98ff7d7-6drmb   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          64s\ntestdep-64c98ff7d7-9ph5j   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4m9s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br")])]),n("h2",{attrs:{id:"创建deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建deployment"}},[s._v("#")]),s._v(" 创建Deployment")]),s._v(" "),n("h3",{attrs:{id:"生成配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#生成配置文件"}},[s._v("#")]),s._v(" 生成配置文件")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl -n mytest create deployment dep-from-file --image=nginx --dry-run=client -o yaml >dep-from-file.yaml")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"根据需要修改配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#根据需要修改配置"}},[s._v("#")]),s._v(" 根据需要修改配置")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim dep-from-file.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat dep-from-file.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: dep-from-file\n  name: dep-from-file\n  namespace: mytest\nspec:\n  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  selector:\n    matchLabels:\n      app: dep-from-file\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: dep-from-file\n    spec:\n      containers:\n      - image: nginx\n        name: nginx\n        imagePullPolicy: IfNotPresent\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h2",{attrs:{id:"创建deployment-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建deployment-2"}},[s._v("#")]),s._v(" 创建Deployment")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f dep-from-file.yaml")]),s._v("\ndeployment.apps/dep-from-file created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps -n mytest")]),s._v("\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\ndep-from-file   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           15s\ntestdep         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           12m\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h2",{attrs:{id:"查看rs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#查看rs"}},[s._v("#")]),s._v(" 查看RS")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get rs -n mytest")]),s._v("\nNAME                       DESIRED   CURRENT   READY   AGE\ndep-from-file-7b78bc4877   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       72s\ntestdep-64c98ff7d7         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("       13m\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"弹性伸缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#弹性伸缩"}},[s._v("#")]),s._v(" 弹性伸缩")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 修改配置文件，修改replicas为4")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim dep-from-file.yaml")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat dep-from-file.yaml")]),s._v("\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  labels:\n    app: dep-from-file\n  name: dep-from-file\n  namespace: mytest\nspec:\n  replicas: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  selector:\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 应用修改")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f dep-from-file.yaml")]),s._v("\ndeployment.apps/dep-from-file configured\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps -n mytest")]),s._v("\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\ndep-from-file   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           3m41s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br")])]),n("h2",{attrs:{id:"滚动更新"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#滚动更新"}},[s._v("#")]),s._v(" 滚动更新")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl set image -h")]),s._v("\nUpdate existing container image"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" of resources.\nUsage:\n  kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-f FILENAME "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" TYPE NAME"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONTAINER_NAME_1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CONTAINER_IMAGE_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CONTAINER_NAME_N")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("CONTAINER_IMAGE_N\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nExamples:\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set a deployment's nginx container image to 'nginx:1.9.1', and its busybox container image to 'busybox'.")]),s._v("\n  kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment/nginx "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("busybox")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("busybox "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.9.1\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Update all deployments' and rc's nginx container's image to 'nginx:1.9.1'")]),s._v("\n  kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployments,rc "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.9.1 --all\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Update image of all containers of daemonset abc to 'nginx:1.9.1'")]),s._v("\n  kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image daemonset abc *"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.9.1\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Print result (in yaml format) of updating nginx container image from local file, without hitting the server")]),s._v("\n  kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image -f path/to/file.yaml "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.9.1 --local -o yaml\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#example1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps -n mytest")]),s._v("\nNAME            READY   UP-TO-DATE   AVAILABLE   AGE\ndep-from-file   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("           2m32s\ntestdep         "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           24m\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl set image deployment dep-from-file nginx=nginx:1.9.1 -n mytest")]),s._v("\ndeployment.apps/dep-from-file image updated\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout status deployment dep-from-file -n mytest")]),s._v("\ndeployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" successfully rolled out\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout status deployment dep-from-file -n mytest")]),s._v("\ndeployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" successfully rolled out\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe deployments.apps -n mytest  dep-from-file")]),s._v("\nName:                   dep-from-file\nNamespace:              mytest\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nEvents:\n  Type    Reason             Age   From                   Message\n  ----    ------             ----  ----                   -------\n  Normal  ScalingReplicaSet  39m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7b78bc4877 to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7dfb96d9dd to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled down replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7b78bc4877 to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  Normal  ScalingReplicaSet  34m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7dfb96d9dd to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled down replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7b78bc4877 to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  Normal  ScalingReplicaSet  12m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7dfb96d9dd to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled down replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7b78bc4877 to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled up replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7dfb96d9dd to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n  Normal  ScalingReplicaSet  11m   deployment-controller  Scaled down replica "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" dep-from-file-7b78bc4877 to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#example2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl set image deployment dep-from-file nginx=nginx:1.8.1 -n mytest --record")]),s._v("\ndeployment.apps/dep-from-file image updated\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -n mytest")]),s._v("\nNAME                             READY   STATUS              RESTARTS   AGE\ndep-from-file-7478c844bc-6x8d4   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m\ndep-from-file-7478c844bc-bf2rw   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          66s\ndep-from-file-7478c844bc-krjj4   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2m\ndep-from-file-7478c844bc-tvsv4   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     ContainerCreating   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          64s\ndep-from-file-7dfb96d9dd-9hzls   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running             "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          39m\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout status deployment dep-from-file -n mytest")]),s._v("\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" out of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" new replicas have been updated"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" old replicas are pending termination"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nWaiting "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" deployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" rollout to finish: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" of "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" updated replicas are available"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\ndeployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" successfully rolled out\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看历史记录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout history deployment -n mytest dep-from-file")]),s._v("\ndeployment.apps/dep-from-file\nREVISION  CHANGE-CAUSE\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("         kubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" image deployment dep-from-file "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("nginx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx:1.8.1 --namespace"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mytest --record"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 查看历史记录详细信息")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout history deployment -n mytest  dep-from-file --revision=3")]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 回滚版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout undo deployment dep-from-file -n mytest --to-revision=2")]),s._v("\ndeployment.apps/dep-from-file rolled back\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout status deployment dep-from-file -n mytest")]),s._v("\ndeployment "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" successfully rolled out\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##验证Pod nginx版本")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl edit pod dep-from-file-7dfb96d9dd-5hghh -n mytest")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nspec:\n  containers:\n  - image: nginx:1.9.1\n    imagePullPolicy: IfNotPresent\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br")])]),n("h2",{attrs:{id:"升级策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#升级策略"}},[s._v("#")]),s._v(" 升级策略")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl explain deployment.spec.strategy.rollingUpdate")]),s._v("\nKIND:     Deployment\nVERSION:  apps/v1\n\nRESOURCE: rollingUpdate "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Object"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\nDESCRIPTION:\n     Rolling update config params. Present only "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" DeploymentStrategyType "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n     RollingUpdate.\n\n     Spec to control the desired behavior of rolling update.\n\nFIELDS:\n   maxSurge     "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n     The maximum number of pods that can be scheduled above the desired number\n     of pods. Value can be an absolute number "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ex: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or a percentage of desired\n     pods "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ex: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(". This can not be "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" MaxUnavailable is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(". Absolute number\n     is calculated from percentage by rounding up. Defaults to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("%. Example:\n     when this is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("%, the new ReplicaSet can be scaled up immediately\n     when the rolling update starts, such that the total number of old and new\n     pods "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" not exceed "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v("% of desired pods. Once old pods have been killed,\n     new ReplicaSet can be scaled up further, ensuring that total number of pods\n     running at any "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" during the update is at "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("most")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("130")]),s._v("% of desired pods.\n\n   maxUnavailable       "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("string"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n     The maximum number of pods that can be unavailable during the update. Value\n     can be an absolute number "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ex: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or a percentage of desired pods "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ex:\n     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("%"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(". Absolute number is calculated from percentage by rounding down. This\n     can not be "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" MaxSurge is "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(". Defaults to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("%. Example: when this is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("\n     to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("%, the old ReplicaSet can be scaled down to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("% of desired pods\n     immediately when the rolling update starts. Once new pods are ready, old\n     ReplicaSet can be scaled down further, followed by scaling up the new\n     ReplicaSet, ensuring that the total number of pods available at all "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("times")]),s._v("\n     during the update is at least "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("70")]),s._v("% of desired pods.\n     \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MaxUnavailable：滚动过程中最多有多少个 Pod 不可用；")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MaxSurge：滚动过程中最多存在多少个 Pod 超过预期 replicas 数量。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br")])]),n("h2",{attrs:{id:"其他操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#其他操作"}},[s._v("#")]),s._v(" 其他操作")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl rollout -h")]),s._v("\nManage the rollout of a resource.\nAvailable Commands:\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("     View rollout "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("history")]),s._v("\n  pause       Mark the provided resource as paused\n  restart     Restart a resource\n  resume      Resume a paused resource\n  status      Show the status of the rollout\n  undo        Undo a previous rollout\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("h2",{attrs:{id:"删除deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#删除deployment"}},[s._v("#")]),s._v(" 删除Deployment")]),s._v(" "),n("div",{staticClass:"language-shell line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-shell"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete -f dep-from-file.yaml")]),s._v("\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dep-from-file"')]),s._v(" deleted\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps -n mytest")]),s._v("\nNAME      READY   UP-TO-DATE   AVAILABLE   AGE\ntestdep   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("           129m\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])])])}),[],!1,null,null,null);t.default=a.exports}}]);