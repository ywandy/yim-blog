(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{573:function(t,a,s){"use strict";s.r(a);var r=s(13),n=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[s("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202404161446958.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"互斥锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#互斥锁"}},[t._v("#")]),t._v(" 互斥锁")]),t._v(" "),s("h3",{attrs:{id:"_1-显示锁-reentrantlock-可重入锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-显示锁-reentrantlock-可重入锁"}},[t._v("#")]),t._v(" 1.显示锁 ReentrantLock （可重入锁）")]),t._v(" "),s("h4",{attrs:{id:"特性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特性"}},[t._v("#")]),t._v(" 特性")]),t._v(" "),s("p",[t._v("支持公平锁、非公平锁")]),t._v(" "),s("ul",[s("li",[t._v("公平锁 线程请求来了，只能在后面排队")]),t._v(" "),s("li",[t._v("非公平锁 线程要抢占cpu去处理")])]),t._v(" "),s("p",[t._v("持有锁期间，可以被中断")]),t._v(" "),s("p",[t._v("支持主动放弃，tryLock")]),t._v(" "),s("p",[t._v("JDK支持，使用稍复杂，必须在finally中unLock()")]),t._v(" "),s("p",[t._v("指当前线程获取==同一个锁==时不会出现死锁。意味着当前线程获取相同的锁时再去获取锁不会被阻塞")]),t._v(" "),s("h3",{attrs:{id:"_2-内置锁-synchronized"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-内置锁-synchronized"}},[t._v("#")]),t._v(" 2.内置锁 synchronized")]),t._v(" "),s("h4",{attrs:{id:"特性-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#特性-2"}},[t._v("#")]),t._v(" 特性")]),t._v(" "),s("p",[t._v("仅支持非公平锁")]),t._v(" "),s("p",[t._v("持有锁期间，不可中断")]),t._v(" "),s("p",[t._v("不支持主动放弃")]),t._v(" "),s("p",[t._v("Java内置，使用简单")]),t._v(" "),s("p",[t._v("锁的是类实例或者类对象")]),t._v(" "),s("p",[t._v("通过monitorenter\ufeff与monitorexit指令保证原子性")]),t._v(" "),s("p",[t._v("总结：")]),t._v(" "),s("p",[t._v("互斥锁的使用 最为重要的是关注锁，临界区，资源的关系。")]),t._v(" "),s("p",[t._v("可见性问题一定要用HB规则推断")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202404111611477.jpeg",alt:"转账案例"}})]),t._v(" "),s("p",[t._v("A通过上述代码转账给B，会出现线程不安全问题")]),t._v(" "),s("p",[t._v("如果把synchronized锁的粒度大一点的话就可以解决 上述图锁的是Accout.class")]),t._v(" "),s("p",[t._v("把临界区里面的共享变量balance锁住，才不会有问题")]),t._v(" "),s("p",[t._v("只有所有的共享变量共用一个锁，才能保证共享变量的读写不出现问题")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"死锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#死锁"}},[t._v("#")]),t._v(" 死锁")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202404121055158.jpeg",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"线程饥饿死锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程饥饿死锁"}},[t._v("#")]),t._v(" 线程饥饿死锁")]),t._v(" "),s("h3",{attrs:{id:"如何避免死锁-coffman条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#如何避免死锁-coffman条件"}},[t._v("#")]),t._v(" 如何避免死锁 Coffman条件")]),t._v(" "),s("h4",{attrs:{id:"_1-互斥-共享资源x和y只能有一个被占用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-互斥-共享资源x和y只能有一个被占用"}},[t._v("#")]),t._v(" 1.互斥：共享资源X和Y只能有一个被占用")]),t._v(" "),s("p",[t._v("方案：没有办法解决")]),t._v(" "),s("h4",{attrs:{id:"_2-占有且等待-线程t1已经取得共享资源x-在等待共享资源y的时候-不释放共享资源x"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-占有且等待-线程t1已经取得共享资源x-在等待共享资源y的时候-不释放共享资源x"}},[t._v("#")]),t._v(" 2.占有且等待：线程T1已经取得共享资源X，在等待共享资源Y的时候，不释放共享资源X")]),t._v(" "),s("p",[t._v("方案：一次性申请所有资源")]),t._v(" "),s("h4",{attrs:{id:"_3-不可抢占-其他线程不能强行抢占线程t1占有的资源。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-不可抢占-其他线程不能强行抢占线程t1占有的资源。"}},[t._v("#")]),t._v(" 3.不可抢占：其他线程不能强行抢占线程T1占有的资源。")]),t._v(" "),s("p",[t._v("方案：主动放弃")]),t._v(" "),s("p",[t._v("实现：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202404121109340.jpeg",alt:""}})]),t._v(" "),s("p",[t._v("如果tar.lock.tryLock()执行不成功，则主动放弃。")]),t._v(" "),s("h4",{attrs:{id:"_4-循环等待-线程t1等待线程t2占有的资源-线程t2等待线程t1占有的资源。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-循环等待-线程t1等待线程t2占有的资源-线程t2等待线程t1占有的资源。"}},[t._v("#")]),t._v(" 4.循环等待：线程T1等待线程T2占有的资源，线程T2等待线程T1占有的资源。")]),t._v(" "),s("p",[t._v("方案：资源排序")]),t._v(" "),s("p",[t._v("实现：A->B->C->A改为A->B->C")]),t._v(" "),s("p",[t._v("先申请A的锁，再申请B的锁，最后申请C的锁")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://pic-new-1304161434.cos.ap-guangzhou.myqcloud.com/img/202404121112018.jpeg",alt:""}})]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"管程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#管程"}},[t._v("#")]),t._v(" 管程")]),t._v(" "),s("p",[t._v("案例：")]),t._v(" "),s("p",[t._v("排队看病")]),t._v(" "),s("p",[t._v("科室1看完去科室2，科室2看完去科室3，科室3看完回科室1拿结果")]),t._v(" "),s("p",[t._v("给科室1建立一个病人队列，同时科室1只能容纳一个人在占用。科室2、3同理")]),t._v(" "),s("p",[t._v("并发条件下，同一时间的共享变量，只能由一个线程占有，其他线程只能等待(thread.wait())")]),t._v(" "),s("p",[t._v("代码：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" monitor\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" buffer"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("N")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" count "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("synchronized")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" insert "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Item")]),t._v(" item"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//每次只能有一个线程进入insert函数，如果多个线程同时调用insert函数，则后来者需要排队等待")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("hr"),t._v(" "),s("h2",{attrs:{id:"mysql锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql锁"}},[t._v("#")]),t._v(" MySQL锁")]),t._v(" "),s("h3",{attrs:{id:"乐观锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#乐观锁"}},[t._v("#")]),t._v(" 乐观锁")]),t._v(" "),s("p",[t._v("当前线程每次去操作数据的时候都认为别人不会修改，更新的时候会判断别人是否会去更新数据，通过版本来判断，如果数据被修改了就拒绝更新，例如cas是乐")]),t._v(" "),s("p",[t._v("观锁，但是严格来说并不是锁，通过原子性来保证数据的同步，")]),t._v(" "),s("h4",{attrs:{id:"版本号方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#版本号方式"}},[t._v("#")]),t._v(" 版本号方式")]),t._v(" "),s("p",[t._v("通过在数据表中添加一个版本号字段，每次修改操作都会更新版本号的值。在提交修改时，检查当前读取的版本号与修改前读取的版本号是否一致，如果一致则说")]),t._v(" "),s("p",[t._v("明没有其他用户修改数据，可以正常提交修改；如果不一致，则说明有其他用户修改了数据，需要回滚事务或重新尝试。")]),t._v(" "),s("h4",{attrs:{id:"时间戳方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#时间戳方式"}},[t._v("#")]),t._v(" 时间戳方式")]),t._v(" "),s("p",[t._v("通过在数据表中添加一个时间戳字段，记录数据的最后修改时间。在提交修改时，检查当前读取的时间戳与修改前读取的时间戳是否一致，如果一致则说明没有其")]),t._v(" "),s("p",[t._v("他用户修改数据，可以正常提交修改；如果不一致，则说明有其他用户修改了数据，需要回滚事务或重新尝试。")]),t._v(" "),s("h3",{attrs:{id:"悲观锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#悲观锁"}},[t._v("#")]),t._v(" 悲观锁")]),t._v(" "),s("p",[t._v("当前线程去操作数据的时候，总是认为别的线程会去修改数据，所以每次操作数据的时候都会上锁，别的线程去操作数据的时候就会阻塞，比如synchronized")]),t._v(" "),s("hr"),t._v(" "),s("h2",{attrs:{id:"redis-分布式锁"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#redis-分布式锁"}},[t._v("#")]),t._v(" Redis 分布式锁")]),t._v(" "),s("h3",{attrs:{id:"jedis原生"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#jedis原生"}},[t._v("#")]),t._v(" jedis原生")])])}),[],!1,null,null,null);a.default=n.exports}}]);