(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{580:function(s,n,e){"use strict";e.r(n);var a=e(13),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"nodeselector"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nodeselector"}},[s._v("#")]),s._v(" nodeSelector")]),s._v(" "),e("h3",{attrs:{id:"基础理论"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础理论"}},[s._v("#")]),s._v(" 基础理论")]),s._v(" "),e("p",[e("code",[s._v("nodeSelector")]),s._v(" 是节点选择约束的最简单推荐形式。"),e("code",[s._v("nodeSelector")]),s._v(" 是 PodSpec 的一个字段。 它包含键值对的映射。为了使 pod 可以在某个节点上运行，该节点的标签中必须包含这里的每个键值对（它也可以具有其他标签）。最常见的用法的是一对键值对。")]),s._v(" "),e("h3",{attrs:{id:"使用nodeselector"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用nodeselector"}},[s._v("#")]),s._v(" 使用nodeSelector")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#查看节点标签")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes --show-labels")]),s._v("\nNAME                  STATUS   ROLES    AGE   VERSION   LABELS\nmaster.example.com    Ready    master   17d   v1.19.4   beta.kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,beta.kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux,kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,kubernetes.io/hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("master.example.com,kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux,node-role.kubernetes.io/master"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\nworker1.example.com   Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   17d   v1.19.4   beta.kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,beta.kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux,kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,kubernetes.io/hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker1.example.com,kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux\nworker2.example.com   Ready    "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   17d   v1.19.4   beta.kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,beta.kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux,kubernetes.io/arch"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("amd64,kubernetes.io/hostname"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker2.example.com,kubernetes.io/os"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("linux\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#给节点打标签")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl label nodes worker1.example.com disk=ssd")]),s._v("\nnode/worker1.example.com labeled\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用nodeSelector调度Pod")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat nodeSelector-pod.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-nodeselector\n  labels:\n    env: "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\n  nodeSelector:\n    disk: ssd\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f nodeSelector-pod.yaml")]),s._v("\npod/nginx-nodeselector created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod -o wide")]),s._v("\nNAME                                              READY   STATUS      RESTARTS   AGE    IP            NODE                  NOMINATED NODE   READINESS GATES\nnginx-nodeselector                                "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          19s    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.57   worker1.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br")])]),e("h2",{attrs:{id:"nodename"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nodename"}},[s._v("#")]),s._v(" NodeName")]),s._v(" "),e("h3",{attrs:{id:"基础理论-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础理论-2"}},[s._v("#")]),s._v(" 基础理论")]),s._v(" "),e("p",[e("code",[s._v("nodeName")]),s._v(" 是节点选择约束的最简单方法，但是由于其自身限制，通常不使用它。"),e("code",[s._v("nodeName")]),s._v(" 是 PodSpec 的一个字段。如果它不为空，调度器将忽略 pod，并且运行在它指定节点上的 kubelet 进程尝试运行该 pod。因此，如果 "),e("code",[s._v("nodeName")]),s._v(" 在 PodSpec 中指定了，则它优先于上面的节点选择方法。 如果指定的节点不存在，将调度失败。")]),s._v(" "),e("h3",{attrs:{id:"使用nodename"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用nodename"}},[s._v("#")]),s._v(" 使用NodeName")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat nodeName.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-nodename\n  labels:\n    env: "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\n  nodeName: worker1.example.com\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f nodeName.yaml")]),s._v("\npod/nginx-nodename created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod nginx-nodename -o wide")]),s._v("\nNAME             READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES\nnginx-nodename   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          37s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.58   worker1.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br")])]),e("h2",{attrs:{id:"亲和度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#亲和度"}},[s._v("#")]),s._v(" 亲和度")]),s._v(" "),e("h3",{attrs:{id:"基础理论-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基础理论-3"}},[s._v("#")]),s._v(" 基础理论")]),s._v(" "),e("p",[e("code",[s._v("nodeSelector")]),s._v(" 提供了一种非常简单的方法来将 pod 约束到具有特定标签的节点上。亲和/反亲和功能极大地扩展了你可以表达约束的类型。关键的增强点是")]),s._v(" "),e("ol",[e("li",[s._v("语言更具表现力（不仅仅是“完全匹配的 AND”）")]),s._v(" "),e("li",[s._v("你可以发现规则是“偏好”，而不是硬性要求，因此，如果调度器无法满足该要求，仍然调度该 pod")]),s._v(" "),e("li",[s._v("你可以使用节点上的 pod 的标签来约束，而不是使用节点本身的标签，来允许哪些 pod 可以或者不可以被放置在一起。")])]),s._v(" "),e("p",[s._v("亲和功能包含两种类型的亲和，即“节点亲和”和“pod 间亲和/反亲和”。节点亲和就像现有的"),e("code",[s._v("nodeSelector")]),s._v("，然而 pod 间亲和/反亲和约束 pod 标签而不是节点标签。")]),s._v(" "),e("p",[s._v("目前有两种类型的节点亲和，分别为 "),e("code",[s._v("requiredDuringSchedulingIgnoredDuringExecution")]),s._v(" 和 "),e("code",[s._v("preferredDuringSchedulingIgnoredDuringExecution")]),s._v("。你可以视它们为“硬”和“软”，意思是，前者指定了将 pod 调度到一个节点上"),e("em",[s._v("必须")]),s._v("满足的规则（就像 "),e("code",[s._v("nodeSelector")]),s._v(" 但使用更具表现力的语法），后者指定调度器将尝试执行但不能保证的"),e("em",[s._v("偏好")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"使用节点亲和"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用节点亲和"}},[s._v("#")]),s._v(" 使用节点亲和")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm deploy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl label nodes worker1.example.com app=web")]),s._v("\nnode/worker1.example.com labeled\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm deploy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl label nodes worker2.example.com disk=hybrid")]),s._v("\nnode/worker2.example.com labeled\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat node-affinity.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: with-node-affinity\nspec:\n  affinity:\n    nodeAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n        nodeSelectorTerms:\n        - matchExpressions:\n          - key: disk\n            operator: In\n            values:\n            - ssd\n            - hybrid\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        preference:\n          matchExpressions:\n          - key: app\n            operator: In\n            values:\n            - web\n  containers:\n  - name: with-node-affinity\n    image: nginx\n    imagePullPolicy: IfNotPresent\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f node-affinity.yaml")]),s._v("\npod/with-node-affinity created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod with-node-affinity -o wide")]),s._v("\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES\nwith-node-affinity   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          13s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.59   worker1.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重新调度")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm deploy"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl label nodes worker1.example.com disk-")]),s._v("\nnode/worker1.example.com labeled\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete -f node-affinity.yaml")]),s._v("\npod "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"with-node-affinity"')]),s._v(" deleted\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f node-affinity.yaml")]),s._v("\npod/with-node-affinity created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod with-node-affinity -o wide")]),s._v("\nNAME                 READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES\nwith-node-affinity   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4s    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.73   worker2.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br"),e("span",{staticClass:"line-number"},[s._v("39")]),e("br"),e("span",{staticClass:"line-number"},[s._v("40")]),e("br"),e("span",{staticClass:"line-number"},[s._v("41")]),e("br"),e("span",{staticClass:"line-number"},[s._v("42")]),e("br"),e("span",{staticClass:"line-number"},[s._v("43")]),e("br"),e("span",{staticClass:"line-number"},[s._v("44")]),e("br"),e("span",{staticClass:"line-number"},[s._v("45")]),e("br"),e("span",{staticClass:"line-number"},[s._v("46")]),e("br"),e("span",{staticClass:"line-number"},[s._v("47")]),e("br"),e("span",{staticClass:"line-number"},[s._v("48")]),e("br"),e("span",{staticClass:"line-number"},[s._v("49")]),e("br"),e("span",{staticClass:"line-number"},[s._v("50")]),e("br"),e("span",{staticClass:"line-number"},[s._v("51")]),e("br"),e("span",{staticClass:"line-number"},[s._v("52")]),e("br"),e("span",{staticClass:"line-number"},[s._v("53")]),e("br"),e("span",{staticClass:"line-number"},[s._v("54")]),e("br")])]),e("h2",{attrs:{id:"pod-间亲和与反亲和"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#pod-间亲和与反亲和"}},[s._v("#")]),s._v(" pod 间亲和与反亲和")]),s._v(" "),e("p",[s._v("pod 间亲和与反亲和使你可以"),e("em",[s._v("基于已经在节点上运行的 pod 的标签")]),s._v("来约束 pod 可以调度到的节点，而不是基于节点上的标签。规则的格式为“如果 X 节点上已经运行了一个或多个 满足规则 Y 的pod，则这个 pod 应该（或者在非亲和的情况下不应该）运行在 X 节点”。")]),s._v(" "),e("h3",{attrs:{id:"使用pod亲和"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用pod亲和"}},[s._v("#")]),s._v(" 使用Pod亲和")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat pod-affinity.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: with-pod-affinity\nspec:\n  affinity:\n    podAffinity:\n      requiredDuringSchedulingIgnoredDuringExecution:\n      - labelSelector:\n          matchExpressions:\n          - key: run\n            operator: In\n            values:\n            - nginx2\n        topologyKey: disk\n    podAntiAffinity:\n      preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n        podAffinityTerm:\n          labelSelector:\n            matchExpressions:\n            - key: security\n              operator: In\n              values:\n              - S2\n          topologyKey: disk\n  containers:\n  - name: with-pod-affinity\n    image: nginx\n    imagePullPolicy: IfNotPresent\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f pod-affinity.yaml")]),s._v("\npod/with-pod-affinity created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod with-pod-affinity -o wide")]),s._v("\nNAME                READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES\nwith-pod-affinity   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          14s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.74   worker2.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br"),e("span",{staticClass:"line-number"},[s._v("37")]),e("br"),e("span",{staticClass:"line-number"},[s._v("38")]),e("br")])]),e("h2",{attrs:{id:"污点和容忍度"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#污点和容忍度"}},[s._v("#")]),s._v(" 污点和容忍度")]),s._v(" "),e("p",[s._v("Taint（污点）与亲和性相反，它使节点能够排斥一类特定的 Pod。")]),s._v(" "),e("p",[s._v("容忍度（Tolerations）是应用于 Pod 上的，允许（但并不要求）Pod 调度到带有与之匹配的污点的节点上。")]),s._v(" "),e("p",[s._v("污点和容忍度（Toleration）相互配合，可以用来避免 Pod 被分配到不合适的节点上。 每个节点上都可以应用一个或多个污点，这表示对于那些不能容忍这些污点的 Pod，是不会被该节点接受的。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl taint nodes node1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value1:NoSchedule\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("ul",[e("li",[s._v("NoSchedule： 这表示只有拥有和这个污点相匹配的容忍度的 Pod 才能够被分配到 "),e("code",[s._v("node1")]),s._v(" 这个节点.")]),s._v(" "),e("li",[s._v("NoExecute ：任何不能忍受这个污点的 Pod 都会马上被驱逐。")])]),s._v(" "),e("p",[s._v("用例：")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("专用节点：如果您想将某些节点专门分配给特定的一组用户使用，您可以给这些节点添加一个污点（即， "),e("code",[s._v("kubectl taint nodes nodename dedicated=groupName:NoSchedule")]),s._v("）， 然后给这组用户的 Pod 添加一个相对应的 toleration（通过编写一个自定义的 "),e("a",{attrs:{href:"https://kubernetes.io/zh/docs/reference/access-authn-authz/admission-controllers/",target:"_blank",rel:"noopener noreferrer"}},[s._v("准入控制器"),e("OutboundLink")],1),s._v("，很容易就能做到）。")])]),s._v(" "),e("li",[e("p",[s._v("配备了特殊硬件的节点：在部分节点配备了特殊硬件（比如 GPU）的集群中， 我们希望不需要这类硬件的 Pod 不要被分配到这些特殊节点，以便为后继需要这类硬件的 Pod 保留资源。 要达到这个目的，可以先给配备了特殊硬件的节点添加 taint （例如 "),e("code",[s._v("kubectl taint nodes nodename special=true:NoSchedule")]),s._v(" 或 "),e("code",[s._v("kubectl taint nodes nodename special=true:PreferNoSchedule")]),s._v(")， 然后给使用了这类特殊硬件的 Pod 添加一个相匹配的 toleration。")])]),s._v(" "),e("li",[e("p",[s._v("基于污点的驱逐: 这是在每个 Pod 中配置的在节点出现问题时的驱逐行为。")])])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#examples")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat taint.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nginx-taint\n  labels:\n    env: "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nspec:\n  containers:\n  - name: nginx\n    image: nginx\n    imagePullPolicy: IfNotPresent\n  tolerations:\n  - key: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GPU"')]),s._v("\n    operator: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Exists"')]),s._v("\n    effect: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f taint.yaml")]),s._v("\npod/nginx-taint created\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod nginx-taint -o wide")]),s._v("\nNAME          READY   STATUS    RESTARTS   AGE   IP            NODE                  NOMINATED NODE   READINESS GATES\nnginx-taint   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          15s   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.60   worker1.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl taint nodes worker1.example.com  GPU=yes:NoExecute")]),s._v("\nnode/worker1.example.com tainted\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod nginx-taint -o wide")]),s._v("\nError from server "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NotFound"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": pods "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-taint"')]),s._v(" not found\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f taint.yaml")]),s._v("\npod/nginx-taint created\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@clientvm ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod  -o wide")]),s._v("\nNAME                     READY   STATUS      RESTARTS   AGE    IP            NODE                  NOMINATED NODE   READINESS GATES\nnginx-taint              "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          2s     "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".2.76   worker2.example.com   "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("           "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br"),e("span",{staticClass:"line-number"},[s._v("33")]),e("br"),e("span",{staticClass:"line-number"},[s._v("34")]),e("br"),e("span",{staticClass:"line-number"},[s._v("35")]),e("br"),e("span",{staticClass:"line-number"},[s._v("36")]),e("br")])]),e("p",[s._v("operator 的默认值是 Equal。")]),s._v(" "),e("p",[s._v("一个容忍度和一个污点相“匹配”是指它们有一样的键名和效果，并且：")]),s._v(" "),e("ul",[e("li",[s._v("如果 operator 是 Exists （此时容忍度不能指定 value），或者")]),s._v(" "),e("li",[s._v("如果 operator 是 Equal ，则它们的 value 应该相等")])]),s._v(" "),e("p",[e("strong",[s._v("说明：")])]),s._v(" "),e("p",[s._v("存在两种特殊情况：")]),s._v(" "),e("ul",[e("li",[s._v("如果一个容忍度的 key 为空且 operator 为 Exists， 表示这个容忍度与任意的 key 、value 和 effect 都匹配，即这个容忍度能容忍任意 taint。")]),s._v(" "),e("li",[s._v("如果 effect 为空，则可以与所有键名 key1 的效果相匹配。")])]),s._v(" "),e("p",[s._v("例如，假设您给一个节点添加了如下污点")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("kubectl taint nodes node1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value1:NoSchedule \nkubectl taint nodes node1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key1")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value1:NoExecute \nkubectl taint nodes node1 "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("key2")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("value2:NoSchedule \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("假定有一个 Pod，它有两个容忍度：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("tolerations:\n- key: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key1"')]),s._v("\n  operator: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n  value: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v("\n  effect: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoSchedule"')]),s._v("\n- key: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"key1"')]),s._v("\n  operator: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Equal"')]),s._v("\n  value: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1"')]),s._v("\n  effect: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NoExecute"')]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("在这种情况下，上述 Pod 不会被分配到上述节点，因为其没有容忍度和第三个污点相匹配。 但是如果在给节点添加上述污点之前，该 Pod 已经在上述节点运行， 那么它还可以继续运行在该节点上，因为第三个污点是三个污点中唯一不能被这个 Pod 容忍的。")]),s._v(" "),e("h2",{attrs:{id:"基于节点状态添加污点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#基于节点状态添加污点"}},[s._v("#")]),s._v(" 基于节点状态添加污点")]),s._v(" "),e("p",[s._v("控制平面使用节点"),e("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/architecture/controller/",target:"_blank",rel:"noopener noreferrer"}},[s._v("控制器"),e("OutboundLink")],1),s._v("自动创建 与"),e("a",{attrs:{href:"https://kubernetes.io/zh/docs/concepts/scheduling-eviction/node-pressure-eviction/#node-conditions",target:"_blank",rel:"noopener noreferrer"}},[s._v("节点状况"),e("OutboundLink")],1),s._v("对应的带有 NoSchedule 效应的污点。当某种条件为真时，节点控制器会自动给节点添加一个污点。当前内置的污点包括：")]),s._v(" "),e("ul",[e("li",[s._v('node.kubernetes.io/not-ready：节点未准备好。这相当于节点状态 Ready 的值为 "False"。')]),s._v(" "),e("li",[s._v('node.kubernetes.io/unreachable：节点控制器访问不到节点. 这相当于节点状态 Ready 的值为 "Unknown"。')]),s._v(" "),e("li",[s._v("node.kubernetes.io/memory-pressure：节点存在内存压力。")]),s._v(" "),e("li",[s._v("node.kubernetes.io/disk-pressure：节点存在磁盘压力。")]),s._v(" "),e("li",[s._v("node.kubernetes.io/pid-pressure: 节点的 PID 压力。")]),s._v(" "),e("li",[s._v("node.kubernetes.io/network-unavailable：节点网络不可用。")]),s._v(" "),e("li",[s._v("node.kubernetes.io/unschedulable: 节点不可调度。")])]),s._v(" "),e("p",[s._v("DaemonSet 控制器自动为所有守护进程添加如下 NoSchedule 容忍度以防 DaemonSet 崩溃：")]),s._v(" "),e("ul",[e("li",[s._v("node.kubernetes.io/memory-pressure")]),s._v(" "),e("li",[s._v("node.kubernetes.io/disk-pressure")]),s._v(" "),e("li",[s._v("node.kubernetes.io/pid-pressure")]),s._v(" "),e("li",[s._v("node.kubernetes.io/unschedulable")])])])}),[],!1,null,null,null);n.default=t.exports}}]);